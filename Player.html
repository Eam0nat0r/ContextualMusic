<!DOCTYPE html>
<html>
    <head>
    
        <title>Proof of Concept - Dynamic Music</title>
    
    
        <style>
        
            
            body
            {
                background-color: gray;
                font-family: Arial;
                font-size: 12pt;
                min-width: 500px;
            }
            h1,h3
            {
                text-align: center;
                text-shadow: 0 0 3px red;
                margin:0;
            }
            audio
            {
                display: block;
                width:100%;
            }
            
            #intensity
            {
                width:100%;
                margin:0 1em 0 1em;
                vertical-align: middle;

                
            }

            button
            {
                border-top: 1px solid white;
                border-right: 1px solid black;
                border-bottom: 1px solid black;
                border-left: 1px solid white;
                border-radius: 3em;
                background-color: yellow;
                position: relative;
                outline: none;
            }
            
            button:active
            {
                border-top: 1px solid black;
                border-right: 1px solid white;
                border-bottom: 1px solid white;
                border-left: 1px solid black;
                top: 0.08em;
                left: 0.08em;
            }
            
            #button_play
            {
                background-color: green;

            }
            #button_pause
            {
                background-color: goldenrod;

            }
            #button_stop
            {
                background-color: maroon;

            }
            button > span
            {
                -webkit-transform:rotate(90deg);
                transform:rotate(90deg);
                font-weight:bold;
                display: inherit;
            }
            #i_bar
            {
                display: flex;
                margin: 1em;
            }
            #volContainer
            {
                display: initial;
                margin:5px;
                font-weight: bold;
                color:white;
            }
            #tracker
            {
                width:75%;
            }
            fieldset
            {
                text-align: center;
                margin:1em;
                border-radius: 1em;
            }
            p
            {
                color: #39c6c6;
                background-color: #222;
                padding: 0.5em;
                border-radius: 1em;
                margin: 2em;
                text-align: justify;
            }
            #low
            {
                color:blue;
                font-weight: bold;
            }
            #high
            {
                color:red;
                font-weight: bold;
            }
        
        </style>
    
    
        <script type="text/javascript">
            
            var audControls = false;
            var loopInt = new Array();

            function buttonStatus(id,newColor,status)
            {
                document.getElementById(id).style.backgroundColor = newColor;
                if (status == "on")
                {
                    document.getElementById(id).style.boxShadow = "0 0 2em "+newColor ;
                }
                else
                {
                    document.getElementById(id).style.boxShadow = "";
                }
            }
            
            function prep()
            {
                for (i=1;i<document.getElementsByTagName("audio").length;i++){
                    document.getElementsByTagName("audio")[i].volume = 0;
                }
                document.getElementById("high").innerText = document.getElementsByTagName("audio").length;
                
                return;
            }
        
            function start()
            {
                for (i=0;i<document.getElementsByTagName("audio").length;i++){
                    document.getElementsByTagName("audio")[i].play()
                }
                
                buttonStatus("button_play","lime","on");
                buttonStatus("button_pause","goldenrod","off");
                buttonStatus("button_stop","maroon","off");
                return;
            
            
            }
            
           function pause()
            {
                for (i=document.getElementsByTagName("audio").length-1;i>=0;i--){
                    document.getElementsByTagName("audio")[i].pause()
                }
                
                buttonStatus("button_play","green","off");
                buttonStatus("button_pause","yellow","on");
                buttonStatus("button_stop","maroon","off");                
                return;
            
            }
            
            function stop()
            {
                for (i=document.getElementsByTagName("audio").length-1;i>=0;i--){
                    document.getElementsByTagName("audio")[i].pause()
                    document.getElementsByTagName("audio")[i].currentTime = 0;
                }
                buttonStatus("button_play","green","off");
                buttonStatus("button_pause","goldenrod","off");
                buttonStatus("button_stop","red","on");                                
                return;
            }
            
            function volumeDial()
            {
                var x = document.getElementById("volume_slider").value;
                for (i=0 ; i<document.getElementsByTagName("audio").length;i++){
                    if (document.getElementsByTagName("audio")[i].volume != 0){
                           document.getElementsByTagName("audio")[i].volume = x/100;
                    }
                }
            }
            
            function intensify()
            {
                var x = document.getElementById("intensity").value;
                
                for (i = 0 ; i < x ; i++)
                {
                    fadeVol(document.getElementsByTagName("audio")[i],i,document.getElementsByTagName("audio")[i].volume,document.getElementById("volume_slider").value,25);
                    //console.log("raising track "+i);
                }
                for (i = document.getElementsByTagName("audio").length-1 ; i > x-1 ; i--)
                {
                    fadeVol(document.getElementsByTagName("audio")[i],i,document.getElementsByTagName("audio")[i].volume,0,25);
                    //console.log("lowering track "+i);
                }
                
                
                return;
            
            }
            function controls()
            {
                if (audControls == false){

                    document.getElementById("trackDisplay").style.display = "block";

                    audControls = true;
                    console.log(audControls);
                }
                else
                {

                    document.getElementById("trackDisplay").style.display = "none";
 
                    audControls = false;
                    console.log(audControls);
                }
                    return;

            }
            
            function fadeVol(track,TID,current,target,speed)
            {
                var current = Math.floor(current * 100);
                var target = Math.floor(target * 100);
                loopInt[i] = setInterval( /*No idea if this is being managed appropriately - still glitchy*/
                        function(){                   
                            
                            
                            if (current > target && current/100 >= 0){
                                track.volume = current/100;
                                current--;
                                if (current == 0) { track.volume = 0 }
                            }
                            if (current < target && current/100 <= 1){
                                track.volume = current/100;
                                current++;
                                if (current == 100) { track.volume = 1 }
                            }
                     
                            else clearInterval(loopInt);
                        }, speed);
                return;
            }
        
        
        
        
        </script>
    
    
    
    
    
    
    
    
    
    </head>
    
    <body onload="prep();">
    
    
        <h1>Song Title Here</h1>
        <h3>Artist Name Here</h3>
    
        <fieldset>
            <legend>Tracks</legend>
            <div id="trackDisplay" style="display:none">
                <audio controls id="T7" >
                    <source src="NYM - Track-07.mp3" type="audio/mpeg">
                </audio>
                
                <audio controls id="T5">
                    <source src="NYM - Track-05.mp3" type="audio/mpeg">
                </audio>            

                <audio controls id="T3">
                    <source src="NYM - Track-03.mp3" type="audio/mpeg">
                </audio>
                
                <audio controls id="T1">
                    <source src="NYM - Track-01.mp3" type="audio/mpeg">
                </audio>
                
                <audio controls id="T2">
                    <source src="NYM - Track-02.mp3" type="audio/mpeg">
                </audio>

                <audio controls id="T6">
                    <source src="NYM - Track-06.mp3" type="audio/mpeg">
                </audio>

                <audio controls id="T4">
                    <source src="NYM - Track-04.mp3" type="audio/mpeg">
                </audio>
            </div>

<p style="margin-bottom:0;text-align:center">INTENSITY METER</p>
        <div id="i_bar">
            <span id="low">1</span><input type="range" id="intensity" min="1" max="7" value="1" onChange="intensify();"><span id="high">7</span></div>
            <button id="button_play" onclick="start();">&#9654; Play</button>
            <button id="button_pause" onclick="pause();"><span>=</span> Pause</button>
            <button id="button_stop" onclick="stop();">&#9632; Stop</button><div id="volContainer">
            Volume: <input type="range" id="volume_slider" min="1" max="100" value="100" onChange="volumeDial();"></div>
            <button id="button_controls" onclick="controls();">Toggle Manual Control</button>
            
        </fieldset>
    
        <p>
            DESCRIPTION: This App is a proof of concept and a partial demonstration of my plain old JavaScript/HTML5/CSS3 abilities.  The idea of context-driven, dynamic music is not new, it is used often in videogames as an effective tool to further increase the immersion the player is experiencing in the game.  In the future I want to see an intensity setting that could accept data from a heart rate monitor to dynamically adjust the music depth depending on the users heart rate during excercise (Running/Biking etc.).  High intensity workout would create a strong motivational pace/strength to a song while starting out/cooling down would create an ambience.  The example I have used is an instrumental but it can be used with songs with lyrics tracks.<br /><br />
            HOW IT WORKS: The app utilizes audio tracks in ascending order from calm instrumentals to more complex/louder instrumentals.  Lowest Intensity will just be track 0 being played.  Highest will be all tracks being played at once.  Changing the meter will fade in the relevant tracks dictated by the numerical value of the slider.
            
            <br /><br />CURRENT LIMITATIONS: Rapidly switching Intensity Meter up and down will cause odd results due to issues with set/clearInterval() in JavaScript.<br />No checks (yet) to see if all tracks have loaded successfully into the page.  This issue will affect this app *only* if hosted anywhere other than localhost/harddrive.
            <br /><br />
            REQUIREMENTS: This app requires audio tracks in .mp3 (Chrome, Internet Explorer, FireFox 21+, Safari) with exactly equal length to guarantee synchronization.
        </p>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    </body>
    



</html>